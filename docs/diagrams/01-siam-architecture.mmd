graph TB
    subgraph "User Layer"
        Browser[ğŸŒ User Browser]
        ChatUI[ğŸ’¬ Chat Interface<br/>Vercel AI SDK v5]
        Voice[ğŸ¤ Voice I/O<br/>ElevenLabs]
    end

    subgraph "Application Server - Render.com"
        NextJS[âš¡ Next.js 15.5.6<br/>thebetabase.com]
        ChatAPI[ğŸ“¡ /api/chat/route.ts]
        Auth[ğŸ” Auth Middleware<br/>Magic Link]
        Cache[ğŸ’¾ Query Cache<br/>In-Memory]
        Orchestrator[ğŸ¯ AOMA Orchestrator<br/>15s timeout]
    end

    subgraph "AI Services"
        OpenAI[ğŸ¤– OpenAI GPT-4o<br/>+ o1-reasoning]
        Embeddings[ğŸ“Š text-embedding-3-small<br/>1536 dimensions]
        ElevenLabs[ğŸ”Š ElevenLabs API<br/>Voice Synthesis]
    end

    subgraph "Data Layer"
        Supabase[(ğŸ—„ï¸ Supabase Postgres<br/>kfxetwuuzljhybfgmpuc)]
        VectorTable[(ğŸ“¦ aoma_unified_vectors<br/>28 rows, pgvector)]
        VectorFunc[âš™ï¸ match_aoma_vectors()<br/>threshold: 0.50]
        Railway[ğŸš‚ Railway MCP Server<br/>aoma-mesh-mcp]
    end

    Browser --> ChatUI
    ChatUI --> Voice
    ChatUI -->|POST /api/chat| NextJS
    NextJS --> Auth
    Auth --> ChatAPI
    ChatAPI --> Cache
    Cache -->|Cache Miss| Orchestrator

    Orchestrator -->|Parallel Query| VectorSearch[ğŸ” Vector Search Service]
    Orchestrator -->|Parallel Query| Railway

    VectorSearch -->|Generate Embedding| Embeddings
    VectorSearch -->|Query| Supabase
    Supabase --> VectorTable
    VectorTable --> VectorFunc

    Orchestrator -->|AI Response| OpenAI
    ChatAPI -->|Stream Response| ChatUI
    ChatUI -->|Voice Output| ElevenLabs

    style Browser fill:#e1f5ff
    style NextJS fill:#fff3e0
    style Supabase fill:#c8e6c9
    style Railway fill:#ffccbc
    style Orchestrator fill:#fff9c4
    style OpenAI fill:#f3e5f5

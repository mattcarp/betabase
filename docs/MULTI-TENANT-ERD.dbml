// SIAM Multi-Tenant Vector Store ERD
// Architecture Date: November 6, 2025
// ðŸŽ¯ Multi-Tenant Knowledge Retrieval Architecture
// Demo Version - Focused on Multi-Tenant Isolation

Project SIAM_VectorStore {
  database_type: 'PostgreSQL with pgvector'
  Note: '''
    ðŸš€ SIAM Multi-Tenant Vector Store
    
    3-tier hierarchy for complete tenant isolation:
    
    ðŸ¢ Sony Music (Organization)
      â†“
    ðŸ“‚ PDE / Label Services / Artist Relations (Divisions)
      â†“
    ðŸŽ¯ AOMA / USM / DAM / CRM (Applications)
    
    âœ¨ Key Features:
    â€¢ Dual AI embeddings (OpenAI 1536d + Gemini 768d)
    â€¢ HNSW vector indexing for sub-200ms search
    â€¢ Zero cross-contamination between apps
    â€¢ Isolated knowledge bases per tenant
    
    ðŸŽ¨ Example: sony-music â†’ pde â†’ aoma
  '''
}

TableGroup TenantHierarchy {
  organization
  division
  app_under_test
}

Table organization [headercolor: #1a1a2e, note: 'ðŸ¢ Level 1: Organization'] {
  name varchar(50) [pk, note: '"sony-music"']
  description text [note: '"Sony Music Entertainment"']
  
  Note: '''
    ðŸ¢ ROOT LEVEL
    Top-level organization containing all divisions
    
    Example:
    â€¢ name: "sony-music"
    â€¢ description: "Sony Music Entertainment - Global music company"
  '''
}

Table division [headercolor: #16213e, note: 'ðŸ“‚ Level 2: Division'] {
  name varchar(50) [pk, note: '"pde", "label-services"']
  organization varchar(50) [not null, ref: > organization.name, note: 'â†’ "sony-music"']
  description text [note: '"Product & Digital Engineering"']
  
  Note: '''
    ðŸ“‚ DIVISION LEVEL
    Business units within the organization
    
    Examples:
    â€¢ pde â†’ "Product & Digital Engineering"
    â€¢ label-services â†’ "Label Services Division"
    â€¢ artist-relations â†’ "Artist Relations"
  '''
}

Table app_under_test [headercolor: #0f3460, note: 'ðŸŽ¯ Level 3: Application'] {
  name varchar(50) [pk, note: '"aoma", "usm", "dam"']
  organization varchar(50) [not null, ref: > organization.name, note: 'â†’ "sony-music"']
  division varchar(50) [not null, ref: > division.name, note: 'â†’ "pde"']
  description text [note: '"Asset & Offering Management"']
  
  Note: '''
    ðŸŽ¯ APPLICATION LEVEL
    Individual apps with isolated knowledge bases
    
    Examples:
    â€¢ aoma â†’ "Asset & Offering Management Application"
    â€¢ usm â†’ "Universal Session Manager"
    â€¢ dam â†’ "Digital Asset Management System"
    
    Each app = Completely isolated vector store
  '''
}

Table siam_vectors [headercolor: #e94560, note: 'ðŸ§  VECTOR STORE - Multi-Tenant Retrieval'] {
  id uuid [pk, note: 'Unique vector ID']
  organization varchar(50) [not null, ref: > organization.name, note: 'ðŸ¢ "sony-music"']
  division varchar(50) [not null, ref: > division.name, note: 'ðŸ“‚ "pde"']
  app_under_test varchar(50) [not null, ref: > app_under_test.name, note: 'ðŸŽ¯ "aoma"']
  content text [not null, note: 'Document content']
  embedding vector(1536) [note: 'ðŸ¤– OpenAI (1536d)']
  embedding_gemini vector(768) [note: 'âœ¨ Gemini (768d)']
  embedding_source text [default: 'openai', note: 'Active embedding']
  source_type text [not null, note: '"jira", "confluence", "git"']
  source_id text [not null, note: 'Source unique ID']
  metadata jsonb [default: '{}', note: 'Flexible metadata']
  created_at timestamp [default: `now()`]
  updated_at timestamp [default: `now()`]
  
  indexes {
    (organization, division, app_under_test, source_type, source_id) [unique, note: 'No duplicates']
    (organization, division, app_under_test) [name: 'tenant_idx', note: 'Fast filtering']
  }
  
  Note: '''
    ðŸš€ THE MAGIC: Complete Tenant Isolation
    
    Real Example (AOMA):
    organization: "sony-music"
    division: "pde"
    app: "aoma"
    content: "To create an asset in AOMA..."
    source: "confluence/123456"
    
    ðŸŽ¯ Multi-Tenant Benefits:
    â€¢ AOMA docs NEVER appear in USM searches
    â€¢ DAM vectors completely separate from CRM
    â€¢ Each app scales independently
    â€¢ Zero data leakage between tenants
    
    âš¡ Performance:
    â€¢ 50-200ms search with HNSW indexing
    â€¢ ~9KB per vector (dual embeddings)
    â€¢ 100+ vectors/second batch insert
  '''
}

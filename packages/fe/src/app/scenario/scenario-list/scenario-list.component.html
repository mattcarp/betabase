<app-nav [isBackActive]="true"></app-nav>

<section>
  <ng-container *ngIf="isLoading; else template">
    <app-spinner></app-spinner>
  </ng-container>

  <ng-template #template>
    <div class="header-flex">
      <h2>
        All Cases
        <span matBadge="{{scenarios?.length}}" matBadgeOverlap="false" matBadgeColor="accent"></span>
      </h2>
      <div class="spacer"></div>
      <button mat-flat-button color="warn" [disabled]="isGeneratePdfBtnDisabled" (click)="onGeneratePdfClick()">
        <i class="fas fa-file-pdf"></i>
        <span>Create PDF Documentation</span>
      </button>
    </div>

    <div class="header-flex">
      <mat-form-field class="form-search">
        <input
          matInput
          #searchTerm
          [type]="'text'"
          [attr.id]="'search'"
          [placeholder]="'Search'"
          (keyup.enter)="onSearchStart(searchTerm?.value)"
          (keyup.esc)="searchTerm.value = ''; onSearchStart('')"
          (input)="onSearchStart(searchTerm?.value)"
          autocomplete="off">
        <button
          (click)="searchTerm.value = ''; onSearchStart('')"
          *ngIf="searchTerm?.value"
          matSuffix mat-icon-button color="warn">
          <i class="fas fa-times-circle"></i>
        </button>
        <button
          [disabled]="!searchTerm?.value?.length"
          (click)="onSearchStart(searchTerm?.value)"
          matSuffix mat-icon-button>
          <i class="fas fa-search"></i>
        </button>
      </mat-form-field>

      <div class="spacer"></div>

      <div class="flex">
        <label>
          Show Entries:
          <mat-form-field class="pagination-select">
            <mat-select [(ngModel)]="pageSize">
              <mat-option *ngFor="let option of listOptions" [value]="option">
                {{option}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </label>

        <pagination-controls (pageChange)="paginationParams.page = $event"></pagination-controls>
      </div>
    </div>

    <div class="grid-container">
      <header class="grid">
        <div #1
             (click)="onToggleSort('id')"
             class="clickable"
             [ngClass]="getClassSortField('id')">
          ID <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #2
             (click)="onToggleSort('name')"
             class="clickable"
             [ngClass]="getClassSortField('name')">
          Name <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #3
             (click)="onToggleSort('createdBy')"
             class="clickable"
             [ngClass]="getClassSortField('createdBy')">
          Creator <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #4
             (click)="onToggleSort('createdAt')"
             class="clickable"
             [ngClass]="getClassSortField('createdAt')">
          Created <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #5
             (click)="onToggleSort('updatedBy')"
             class="clickable"
             [ngClass]="getClassSortField('updatedBy')">
          Updater <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #6
             (click)="onToggleSort('updatedAt')"
             class="clickable"
             [ngClass]="getClassSortField('updatedAt')">
          Updated <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #7
             (click)="onToggleSort('reviewFlag')"
             class="clickable"
             [ngClass]="getClassSortField('reviewFlag')">
          Flag <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #8>Actions</div>
      </header>

      <div *ngFor="let scenario of sortedScenarios | paginate: { currentPage, itemsPerPage: pageSize };
              let i = index"
           class="grid">
        <div #1 class="center">
          <div>
            <a routerLink="/scenario/{{app}}/{{scenario?.id}}/show">{{scenario?.id}}</a>
          </div>
        </div>
        <div #2 [innerHTML]="scenario?.name | highlightSearch: paginationParams.searchTerm"></div>
        <div #3 [innerHTML]="scenario?.createdBy | highlightSearch: paginationParams.searchTerm"></div>
        <div #4>{{scenario?.createdAt | date: 'yyyy-MM-dd'}}</div>
        <div #5 [innerHTML]="scenario?.updatedBy | highlightSearch: paginationParams.searchTerm"></div>
        <div #6>{{scenario?.updatedAt | date: 'yyyy-MM-dd'}}</div>
        <div #7 class="center">{{scenario?.reviewFlag ? 'Yes' : 'No'}}</div>
        <div #8 class="center actions">
          <a routerLink="/scenario/{{app}}/{{scenario?.id}}/show" mat-icon-button>
            <i class="fas fa-eye"></i>
          </a>
          <a routerLink="/scenario/{{app}}/{{scenario?.id}}/edit" mat-icon-button>
            <i class="fas fa-edit"></i>
          </a>
          <a mat-icon-button (click)="onDeleteClick(scenario)">
            <i class="fas fa-trash"></i>
          </a>
        </div>
      </div>
    </div>

  </ng-template>
</section>

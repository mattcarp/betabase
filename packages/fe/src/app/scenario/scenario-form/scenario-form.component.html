<app-nav [isBackActive]="true"></app-nav>

<section>
  <div *ngIf="isLoading" class="spinner">
    <div class="spinner-progress"></div>
    <div class="spinner-info">Loading...</div>
  </div>

  <div *ngIf="!isLoading && scenario">
    <h2>Edit Case {{scenario?.id}}</h2>

    <div>Name</div>
    <mat-form-field class="full-width">
      <input matInput [(ngModel)]="scenario.name" type="text">
    </mat-form-field>

    <div class="row">
      <label>Preconditions</label>
      <angular-editor [(ngModel)]="scenario.preconditions" [config]="config"></angular-editor>
    </div>

    <div class="row">
      <label>Script</label>
      <angular-editor [(ngModel)]="scenario.script" [config]="config"></angular-editor>
    </div>

    <div class="row">
      <label>Expected Result</label>
      <angular-editor [(ngModel)]="scenario.expectedResult" [config]="config"></angular-editor>
    </div>

    <div class="grid">
      <div>
        <mat-form-field>
          <mat-label>Coverage</mat-label>
          <mat-select [(ngModel)]="scenario.coverage">
            <mat-option *ngFor="let option of coverageOptions" [value]="option">{{option}}</mat-option>
          </mat-select>
        </mat-form-field>

        <div class="row">
          <mat-form-field>
            <mat-label>Mode</mat-label>
            <mat-select [(ngModel)]="scenario.mode">
              <mat-option *ngFor="let option of modeOptions" [value]="option">{{option}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
      </div>

      <div>
        <div class="row">
          <mat-slide-toggle
            [ngModel]="scenario.isSecurity"
            (ngModelChange)="onCheckboxChange($event, 'isSecurity')">
            <span>Security</span>
            <i matTooltip="Does this case cover application security?" class="fas fa-question-circle"></i>
          </mat-slide-toggle>
        </div>

        <div class="row">
          <mat-slide-toggle
            [ngModel]="scenario.reviewFlag"
            (ngModelChange)="onCheckboxChange($event, 'reviewFlag')">
            <span>Flag for Review</span>
            <i matTooltip="Is the script incomplete?  See a problem with this case? Flag it for review."
               class="fas fa-question-circle">
            </i>
          </mat-slide-toggle>
        </div>

        <ng-container *ngIf="scenario?.reviewFlag">
          <div class="row">
            <mat-form-field class="full-width textarea">
              <mat-label>Reason for Review</mat-label>
              <textarea matInput [(ngModel)]="scenario.flagReason"></textarea>
            </mat-form-field>
          </div>
        </ng-container>

        <div class="row">
          <mat-slide-toggle
            [ngModel]="scenario.clientPriority"
            (ngModelChange)="onCheckboxChange($event, 'clientPriority')">
            <span>Priority</span>
            <i matTooltip="Has this case been deemed a priority?" class="fas fa-question-circle"></i>
          </mat-slide-toggle>
        </div>
      </div>
    </div>

    <div class="actions-container">
      <button mat-flat-button (click)="onSaveClick()" color="accent" class="actions-button">
        <i class="fas fa-save"></i>
        <span>{{saveBtnLabel}}</span>
      </button>

      <button
        *ngIf="isAdmin && scenario?.id"
        (click)="onDeleteClick()"
        mat-flat-button
        color="warn"
        class="actions-button">
        <i class="fas fa-trash-alt"></i>
        <span>Delete</span>
      </button>
    </div>
  </div>
</section>

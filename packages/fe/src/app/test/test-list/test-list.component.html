<app-nav [isBackActive]="true"></app-nav>

<section>
  <ng-container *ngIf="isLoading; else template">
    <app-spinner></app-spinner>
  </ng-container>

  <ng-template #template>
      <h2>
        All Tests
        <span matBadge="{{tests?.length}}" matBadgeOverlap="false" matBadgeColor="accent"></span>
      </h2>

    <div class="header-flex">
      <mat-form-field class="form-search">
        <input
          matInput
          #searchTerm
          [type]="'text'"
          [attr.id]="'search'"
          [placeholder]="'Search'"
          (keyup.enter)="onSearchStart(searchTerm?.value)"
          (keyup.esc)="searchTerm.value = ''; onSearchStart('')"
          (input)="onSearchStart(searchTerm?.value)"
          autocomplete="off">
        <button
          (click)="searchTerm.value = ''; onSearchStart('')"
          *ngIf="searchTerm?.value"
          matSuffix mat-icon-button color="warn">
          <i class="fas fa-times-circle"></i>
        </button>
        <button
          [disabled]="!searchTerm?.value?.length"
          (click)="onSearchStart(searchTerm?.value)"
          matSuffix mat-icon-button>
          <i class="fas fa-search"></i>
        </button>
      </mat-form-field>

      <div class="spacer"></div>

      <div>
        <label>
          Show Entries:
          <mat-form-field class="pagination-select">
            <mat-select [(ngModel)]="pageSize">
              <mat-option *ngFor="let option of listOptions" [value]="option">
                {{option}}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </label>

        <pagination-controls (pageChange)="paginationParams.page = $event"></pagination-controls>
      </div>
    </div>

    <div class="grid-container">
      <header class="grid">
        <div #1
             (click)="onToggleSort('scenarioId')"
             class="clickable"
             [ngClass]="getClassSortField('scenarioId')">
          ID <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #2
             (click)="onToggleSort('updatedAt')"
             class="clickable"
             [ngClass]="getClassSortField('updatedAt')">
          Updated <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #3
             (click)="onToggleSort('deploymentStamp')"
             class="clickable"
             [ngClass]="getClassSortField('deploymentStamp')">
          Deployment <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #4
             (click)="onToggleSort('createdBy')"
             class="clickable"
             [ngClass]="getClassSortField('createdBy')">
          Tester <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #5
             (click)="onToggleSort('passFail')"
             class="clickable"
             [ngClass]="getClassSortField('passFail')">
          P/F <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #6
             (click)="onToggleSort('result')"
             class="clickable"
             [ngClass]="getClassSortField('result')">
          Result <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #7
             (click)="onToggleSort('browser')"
             class="clickable"
             [ngClass]="getClassSortField('browser')">
          Browser <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #8
             (click)="onToggleSort('os')"
             class="clickable"
             [ngClass]="getClassSortField('os')">
          OS <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #9
             (click)="onToggleSort('ticket')"
             class="clickable"
             [ngClass]="getClassSortField('ticket')">
          JIRA <span [ngClass]="getClassDirection()"></span>
        </div>
        <div #10>Actions</div>
      </header>

      <div *ngFor="let entity of tests | paginate: { itemsPerPage: pageSize, currentPage: paginationParams.page };
              let i = index"
           class="grid">
        <div #1 class="center">
          <div>
            <a routerLink="/scenario/{{app}}/{{entity?.scenarioId}}/show">{{entity?.scenarioId}}</a>
          </div>
        </div>
        <div #2>{{entity?.updatedAt | date: 'yyyy-MM-dd'}}</div>
        <div #3>{{entity?.deploymentStamp | date: 'yyyy-MM-dd'}}</div>
        <div #4 [innerHTML]="entity?.createdBy | highlightSearch: paginationParams.searchTerm"></div>
        <div #5 class="center">
          <label *ngIf="entity?.passFail === 'Fail'" class="label-warning">{{entity?.passFail}}</label>
          <label *ngIf="entity?.passFail === 'Pass'" class="label-success">{{entity?.passFail}}</label>
        </div>
        <div #6 [innerHTML]="entity?.result | slice:0:200 | highlightSearch: paginationParams.searchTerm"
             class="inner-html">
        </div>
        <div #7>{{entity?.browserName}} {{entity?.browserMajor}}{{entity?.browserMinor}}</div>
        <div #8>{{entity?.osName}} {{entity?.osMajor}} {{entity?.osMinor}}</div>
        <div #9 class="center">
          <div *ngIf="entity?.ticket?.length">
            <a href="https://jira.smedigitalapps.com/jira/browse/{{entity?.ticket}}" target="_blank" class="ext">
              {{entity?.ticket}}
            </a>
          </div>
        </div>
        <div #10 class="center actions">
          <a routerLink="/test/{{app}}/{{entity?.id}}/show" mat-icon-button>
            <i class="fas fa-eye"></i>
          </a>
          <a routerLink="/test/{{app}}/{{entity?.id}}/edit" mat-icon-button>
            <i class="fas fa-edit"></i>
          </a>
        </div>
      </div>
    </div>

  </ng-template>
</section>


<app-nav [isBackActive]="true"></app-nav>

<section>

  <ng-container *ngIf="isLoading; else template">
    <app-spinner></app-spinner>
  </ng-container>

  <ng-template #template>
    <ng-container *ngIf="!round?.id; else existingRound">
      <h2>Round creation</h2>
      <p class="red">Note: to use the fancy editor on the round notes, save this and then edit it.</p>
    </ng-container>
    <ng-template #existingRound>
      <h2>Edit Testing Round</h2>
      <p class="red">Note: 'Release num' field must match the JIRA 'Fix Version' exactly!</p>
    </ng-template>

    <div *ngIf="round">
      <div class="row">
        <label>Tester Notes</label>
        <ngx-editor-menu [editor]="notesEditor" [toolbar]="toolbarEditor"></ngx-editor-menu>
        <ngx-editor [outputFormat]="'html'" [editor]="notesEditor" [(ngModel)]="round.notes"></ngx-editor>
      </div>

      <div class="columns">
        <div>
          <mat-form-field class="full-width">
            <mat-label>App</mat-label>
            <input matInput [(ngModel)]="round.app" type="text" required>
            <mat-error *ngIf="!round.app">App is required</mat-error>
          </mat-form-field>

          <mat-form-field class="full-width textarea">
            <mat-label>Client notes</mat-label>
            <textarea matInput [(ngModel)]="round.clientNotes"></textarea>
          </mat-form-field>

          <mat-slide-toggle
            [ngModel]="round.currentFlag"
            (ngModelChange)="onCheckboxChange($event)">
            <span>Current Round</span>
          </mat-slide-toggle>
        </div>

        <div>
          <mat-form-field class="full-width">
            <mat-label>Name</mat-label>
            <input matInput [(ngModel)]="round.name" type="text" required>
            <mat-error *ngIf="!round.name">Name is required</mat-error>
          </mat-form-field>

          <div>
            <mat-form-field class="datepicker">
              <mat-label>Starts At</mat-label>
              <input
                matInput
                [value]="round?.startsAt"
                [ngxMatDatetimePicker]="startsAt"
                (dateChange)="onDateChange('startsAt', $event)">
              <mat-datepicker-toggle matSuffix [for]="$any(startsAt)"></mat-datepicker-toggle>
              <ngx-mat-datetime-picker
                #startsAt
                [showSpinners]="true"
                [showSeconds]="false"
                [enableMeridian]="true"
                [stepHour]="1"
                [stepMinute]="1"
                [stepSecond]="1">
              </ngx-mat-datetime-picker>
            </mat-form-field>
          </div>

          <mat-form-field class="datepicker">
            <mat-label>Ends At</mat-label>
            <input
              matInput
              [value]="round?.endsAt"
              [ngxMatDatetimePicker]="endsAt"
              (dateChange)="onDateChange('endsAt', $event)">
            <mat-datepicker-toggle matSuffix [for]="$any(endsAt)"></mat-datepicker-toggle>
            <ngx-mat-datetime-picker
              #endsAt
              [showSpinners]="true"
              [showSeconds]="false"
              [enableMeridian]="true"
              [stepHour]="1"
              [stepMinute]="1"
              [stepSecond]="1">
            </ngx-mat-datetime-picker>
          </mat-form-field>

          <mat-form-field class="full-width">
            <mat-label>Release Number</mat-label>
            <input matInput [(ngModel)]="round.releaseNum" type="text">
          </mat-form-field>
        </div>
      </div>
    </div>

    <div class="actions-container">
      <button
        [disabled]="!round?.app"
        (click)="onSaveClick()"
        mat-flat-button
        color="accent"
        class="actions-button">
        <ng-container *ngIf="!round?.id">
          <i class="fas fa-plus-circle"></i>
          <span>Create</span>
        </ng-container>
        <ng-container *ngIf="round?.id">
          <i class="fas fa-save"></i>
          <span>Save Edits</span>
        </ng-container>
      </button>

      <button
        *ngIf="round?.id"
        (click)="onDeleteClick()"
        mat-flat-button
        color="warn"
        class="actions-button">
        <i class="fas fa-trash-alt"></i>
        <span>Delete</span>
      </button>
    </div>

  </ng-template>
</section>
